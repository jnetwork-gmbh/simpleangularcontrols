<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Bootstrap 3 Angular Controls</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">Bootstrap 3 Angular Controls</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content class">
                   <div class="content-data">











<ol class="breadcrumb">
  <li>Classes</li>
  <li>NgUploadFile</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>projects/jngcontrols-common/src/common/baseuploadcontrol.ts</code>
        </p>





            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#documentid">documentid</a>
                            </li>
                            <li>
                                <a href="#name">name</a>
                            </li>
                            <li>
                                <a href="#progress">progress</a>
                            </li>
                            <li>
                                <a href="#status">status</a>
                            </li>
                            <li>
                                <a href="#uploadId">uploadId</a>
                            </li>
                        </ul>
                    </td>
                </tr>






        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(ufile: <a href="../s/load.html">UploadState</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="14" class="link-to-prism">projects/jngcontrols-common/src/common/baseuploadcontrol.ts:14</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>ufile</td>
                                                  
                                                        <td>
                                                                        <code><a href="../miscellaneous/variables.html#load" target="_self" >UploadState</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
        <h3 id="inputs">
            Properties
        </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="documentid"></a>
                        <span class="name">
                            <b>
                            documentid</b>
                            <a href="#documentid"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="14" class="link-to-prism">projects/jngcontrols-common/src/common/baseuploadcontrol.ts:14</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="name"></a>
                        <span class="name">
                            <b>
                            name</b>
                            <a href="#name"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="10" class="link-to-prism">projects/jngcontrols-common/src/common/baseuploadcontrol.ts:10</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="progress"></a>
                        <span class="name">
                            <b>
                            progress</b>
                            <a href="#progress"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="12" class="link-to-prism">projects/jngcontrols-common/src/common/baseuploadcontrol.ts:12</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="status"></a>
                        <span class="name">
                            <b>
                            status</b>
                            <a href="#status"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="13" class="link-to-prism">projects/jngcontrols-common/src/common/baseuploadcontrol.ts:13</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="uploadId"></a>
                        <span class="name">
                            <b>
                            uploadId</b>
                            <a href="#uploadId"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="11" class="link-to-prism">projects/jngcontrols-common/src/common/baseuploadcontrol.ts:11</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
</section>







    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { EventEmitter, forwardRef, Injector, ViewChild, Input, Output, ElementRef, Renderer2, OnInit, OnDestroy } from &#x27;@angular/core&#x27;;
import { ValidationErrors, AbstractControl } from &#x27;@angular/forms&#x27;;
import { NgBaseModelControl } from &#x27;./basemodelcontrol&#x27;;
import { NgFormularCommon } from &#x27;../controls/form/form&#x27;;
import { UploadxControlEvent, UploadxOptions, UploadState, UploadxService } from &#x27;ngx-uploadx&#x27;;
import { Validation } from &#x27;../validation&#x27;;
import { NgZone } from &#x27;@angular/core&#x27;;

export class NgUploadFile {
  name: string;
  uploadId: string;
  progress: number;
  status: string;
  documentid: string;

  constructor(ufile: UploadState) {
    this.uploadId &#x3D; ufile.uploadId;
    this.name &#x3D; ufile.name;
    this.progress &#x3D; ufile.progress;
    this.status &#x3D; ufile.status;
    this.documentid &#x3D; null;
  }
}

export abstract class NgUploadBase&lt;VALUE&gt; extends NgBaseModelControl&lt;VALUE&gt; implements OnInit, OnDestroy {

  uploads: NgUploadFile[];
  private options: UploadxOptions &#x3D; {};
  private uploadService: UploadxService;
  private _allowedtypes: string &#x3D; &quot;*&quot;;
  private _autoupload: boolean &#x3D; false;
  private _enablepause: boolean &#x3D; true;
  private _endpoint: string &#x3D; null;

  @Input(&quot;allowedtypes&quot;)
  set allowedtypes(types: string) {
    this._allowedtypes &#x3D; types;
    this.setAllowedTypes(types);
  }
  get allowedtypes(): string {
    return this._allowedtypes;
  }

  @Input(&quot;autoupload&quot;)
  set autoupload(v: boolean) {
    this._autoupload &#x3D; v;
    this.options.autoUpload &#x3D; v;
    this.uploadService.connect(this.options);
  }
  get autoupload(): boolean {
    return this._autoupload;
  }

  @Input(&quot;enablepause&quot;)
  set enablepause(v: boolean) {
    this._enablepause &#x3D; v;
  }
  get enablepause(): boolean {
    return this._enablepause;
  }

  @Input(&quot;maxfilesize&quot;) maxfilesize: number &#x3D; 0;

  /**
   * Definiert den Registration Endpoint für Uploads.
   */
  @Input(&quot;endpoint&quot;)
  set endpoint(v: string) {
    this._endpoint &#x3D; v;
    this.setEndpoint(v);
  };
  get endpoint(): string {
    return this._endpoint;
  }

  @Output(&quot;onfileerror&quot;) onfileerror &#x3D; new EventEmitter&lt;string&gt;();

  // File Input Control
  @ViewChild(&quot;files&quot;)
  private uploadInput: ElementRef;
  // Listener für Files
  listenerFn: () &#x3D;&gt; void;

  /**
   * Constructor
   */
  constructor(parent: NgFormularCommon, injector: Injector, private renderer: Renderer2, private ngZone: NgZone) {
    super(parent, injector);

    this.uploads &#x3D; [];
    
    this.options.allowedTypes &#x3D; &#x27;*&#x27;;
    this.options.concurrency &#x3D; 1;
    this.options.token &#x3D; &#x27;sometoken&#x27;;
    this.options.autoUpload &#x3D; this._autoupload;
    this.options.withCredentials &#x3D; true;
    this.options.chunkSize &#x3D; 1024 * 16 * 8;
    this.options.headers &#x3D; (f: File) &#x3D;&gt; ({
      &#x27;Content-Disposition&#x27;: &#x60;filename&#x3D;${encodeURI(f.name)}&#x60;
    });

    // Init new Service Instance
    this.uploadService &#x3D; new UploadxService(this.ngZone);
    this.uploadService.init(this.options);

    // Subscripe Event for State changes
    this.uploadService.events.subscribe((ufile: UploadState) &#x3D;&gt; this.onUpload(ufile));
  }

  /**
   * Initialisiert das Control
   */
  ngOnInit() {
    super.ngOnInit();
    // Init Event Listener for Input File Control and Handling Files
    this.listenerFn &#x3D; this.renderer.listen(this.uploadInput.nativeElement, &#x27;change&#x27;, this.fileListener);

    this.setAllowedTypes(this._allowedtypes);
    this.setEndpoint(this._endpoint);

    if (this._endpoint &#x3D;&#x3D;&#x3D; null)
      throw new Error(&#x27;endpoint is not defined!&#x27;);

    this.uploadService.connect(this.options);
  }

  /**
   * Destroy des Controls
   */
  ngOnDestroy() {
    if (this.listenerFn) {
      this.listenerFn();
    }
  }

  //#region Properties

  // Definiert das Control als Required
  @Input(&quot;isrequired&quot;) _isrequired: boolean &#x3D; false;

  //#endregion

  //#region All File Events

  /**
   * Cancel all Uploaded files
   */
  cancelAll() {
    if (this.HasQueueItem() &#x3D;&#x3D;&#x3D; true)
      this.uploadService.control({ action: &#x27;cancelAll&#x27; });
  }

  /**
   * Upload all queued Files
   */
  uploadAll() {
    if (this.IsStateToUpload() &#x3D;&#x3D;&#x3D; true)
      this.uploadService.control({ action: &#x27;uploadAll&#x27; });
  }

  /**
   * Pause all Uploads
   */
  pauseAll() {
    if (this.IsUploading() &#x3D;&#x3D;&#x3D; true)
      this.uploadService.control({ action: &#x27;pauseAll&#x27; });
  }

  //#endregion

  //#region Singel File Events

  /**
   * Cancel single upload
   * @param uploadId ID of File to cancel
   */
  cancel(uploadId) {
    this.uploadService.control({ action: &#x27;cancel&#x27;, uploadId: uploadId });
  }


  /**
   * Cancel Single File
   * @param uploadId ID of File to Cancel
   */
  pause(uploadId) {
    this.uploadService.control({ action: &#x27;pause&#x27;, uploadId });
  }

  /**
   * Upload Single File
   * 
   * @param uploadId ID of File to Upload
   */
  upload(uploadId) {
    this.uploadService.control({ action: &#x27;upload&#x27;, uploadId });
  }

  //#endregion

  //#region UI Property Helper

  HasQueueItem(): boolean {
    return this.uploads.length &gt; 0;
  }

  IsStateToUpload(): boolean {
    return this.uploads.filter(itm &#x3D;&gt; itm.status &#x3D;&#x3D; &#x27;added&#x27; || itm.status &#x3D;&#x3D; &#x27;paused&#x27;).length &gt; 0;
  }

  IsUploading(): boolean {
    return this.uploads.filter(itm &#x3D;&gt; itm.status &#x3D;&#x3D; &#x27;uploading&#x27;).length &gt; 0;
  }

  IsPaused(): boolean {
    return this.uploads.filter(itm &#x3D;&gt; itm.status &#x3D;&#x3D; &#x27;paused&#x27;).length &gt; 0;
  }

  Filename(): string {
    if (this.uploads.length &gt; 0) {
      return this.uploads[0].name;
    } else {
      return &#x27;Keine Datei ausgewählt&#x27;;
    }
  }

  HasSuccessUpload(): boolean {
    if (this.uploads.length &gt; 0) {
      return this.uploads.filter(itm &#x3D;&gt; itm.status !&#x3D; &#x27;complete&#x27;).length &#x3D;&#x3D; 0;
    } else {
      return false;
    }
  }

  Progress(): number {
    if (this.uploads.length &gt; 0) {
      return this.uploads[0].progress;
    } else {
      return 0;
    }
  }

  //#endregion

  //#region Validation

  validateData(c: AbstractControl): ValidationErrors | null {
    let error: ValidationErrors | null &#x3D; null;

    if (this._isrequired) {
      error &#x3D; Validation.required(c, this._label);
    }

    return error;
  }

  //#endregion

  /**
   * Setzt die erlaubten Datentypen für den Upload
   * 
   * @param types Erlaubte File Extensions
   */
  private setAllowedTypes(types: string) {
    this.renderer.setAttribute(this.uploadInput.nativeElement, &quot;accept&quot;, types);
    this.options.allowedTypes &#x3D; types;
  }

  /**
   * Setzt den Upload Endpoit
   * @param url Register URI
   */
  private setEndpoint(url: string) {
    this.options.endpoint &#x3D; url;
  }

  /**
   * Prüft ob die Dateierweiterung gültig ist
   * 
   * @param filename Dateiname
   */
  private isExtensionValid(filename: string): boolean {

    if (this._allowedtypes &#x3D;&#x3D;&#x3D; &quot;*&quot;)
      return true;

    let isValid: boolean &#x3D; false;
    let extensions: string[] &#x3D; this._allowedtypes.split(&#x27;|&#x27;);

    extensions.forEach(itm &#x3D;&gt; {
      if (filename.endsWith(itm))
        isValid &#x3D; true;
    });

    return isValid;
  }

  /**
   * Prüft ob das File nicht zu gross ist.
   * 
   * @param filesize Max File Size in Bytes
   */
  private isFileSizeValid(filesize: number): boolean {
    if (this.maxfilesize &#x3D;&#x3D;&#x3D; 0)
      return true;

    return this.maxfilesize &gt;&#x3D; filesize
  }

  /**
   * Upload Event
   * 
   * @param uploadsOutStream Upload Item
   */
  onUpload(ufile: UploadState) {
    const index &#x3D; this.uploads.findIndex(f &#x3D;&gt; f.uploadId &#x3D;&#x3D;&#x3D; ufile.uploadId);

    if (ufile.status &#x3D;&#x3D;&#x3D; &#x27;added&#x27;) {
      if (this.isExtensionValid(ufile.name) &amp;&amp; this.isFileSizeValid(ufile.size) &amp;&amp; this.CustomAddValidation(ufile)) {
        this.uploads.push(new NgUploadFile(ufile));
      } else {
        this.cancel(ufile.uploadId);

        if (!this.isExtensionValid(ufile.name))
          this.onfileerror.emit(&quot;INVALID_EXTENSION&quot;);
        else if (!this.isFileSizeValid(ufile.size))
          this.onfileerror.emit(&quot;INVALID_FILESIZE&quot;);
      }
    } else if (ufile.status &#x3D;&#x3D;&#x3D; &#x27;cancelled&#x27;) {
      if (index &gt;&#x3D; 0)
        this.uploads.splice(index, 1);

      this.SetUploadValue(null);
    }
    else if (ufile.status &#x3D;&#x3D;&#x3D; &#x27;complete&#x27;) {
      this.uploads[index].progress &#x3D; ufile.progress;
      this.uploads[index].status &#x3D; ufile.status;
      this.SetUploadValue(ufile);
    } else {
      if (index &gt;&#x3D; 0) {
        this.uploads[index].progress &#x3D; ufile.progress;
        this.uploads[index].status &#x3D; ufile.status;
      }
    }
  }

  /**
   * Handling von neuen Files im Input Control
   */
  fileListener &#x3D; () &#x3D;&gt; {
    if (this.uploadInput.nativeElement.files) {
      this.uploadService.handleFileList(this.uploadInput.nativeElement.files);
    }
  };

  /**
   * Methode welche die Upload ID&#x27;s in das Model setzt oder löscht
   * 
   * @param file Type von File ID&#x27;s
   */
  abstract SetUploadValue(file: UploadState);

  /**
   * Methode kann für Controls verwendet werden, zusätzliche Validierungen bei hinzufügen der Files zu machen
   * 
   * @param file File das hinzugefügt wurde.
   */
  abstract CustomAddValidation(file: UploadState): boolean;
}
</code></pre>
    </div>
</div>







                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'class';
            var COMPODOC_CURRENT_PAGE_URL = 'NgUploadFile.html';
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
